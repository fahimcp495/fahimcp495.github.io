---
layout: page
title: Exclusion DP
usemathjax: true
---

### Template Problem

{: .box-note}
তোমাকে একটি নম্বর $$ n $$ ($$ 1 \le n \le 10^5 $$) দেওয়া হয়েছে। এখন প্রত্যেক $$ i $$ ($$ 1 \le i \le n $$) এর জন্য তোমাকে বের করতে হবে $$ 1 $$ থেকে $$ n $$ পর্যন্ত নম্বরগুলোর মধ্যে এমন কতগুলো pair আছে যাদের $$ \gcd $$ $$ i $$.

### Prerequisites
* Sieve of Eratosthens

### Tutorial
Formally, প্রত্যেক $$ i $$ এর জন্য বের করতে হবে এমন কতগুলো $$ (j, k) $$ আছে যাতে $$ 1 \le j \le k \le n $$ এবং $$ \gcd(j, k) = i $$। \\
আমরা যদি প্রত্যেক $$ i $$ এর জন্য আন্সার f[i] তে রাখি তাহলে, \\
$$ f[i] = $$ number of $$ (j, k) $$ such that  $$ 1 \le j \le k \le n $$ && $$ \gcd(j, k) = i $$

$$ n = 6 $$ এর জন্য প্রত্যেক $$ f[i] $$ বের করে দেখি। \\
$$ f[6] = 1 \; [(6, 6)] $$  
$$ f[5] = 1 \; [(5, 5)] $$  
$$ f[4] = 1 \; [(4, 4))] $$  
$$ f[3] = 2 \; [(3, 3), (3, 6)] $$  
$$ f[2] = 4 \; [(2, 2), (2, 4), (2, 6), (4, 6)] $$  
$$ f[1] = 12 \; [(1, 1), (1, 2), (1, 3), (1, 4), (1, 5), (1, 6), (2, 3), (2, 5), (3, 4), (3, 5), (4, 5), (5, 6)] $$  

খেয়াল করো- যদি $$ \gcd(j, k) = i $$ হয় তবে $$ j $$ এবং $$ k $$ উভয়ই $$ i $$ এর গুণিতক হবে। এখন মনে হতে পারে $$ i $$ এর গুণিতক যে নম্বরগুলো আছে তাদের থেকে যেকোনো দুইটি নম্বর নিলেই তাদের $$ \gcd $$ $$ i $$ হবে। কিন্তু এটা সত্য না :(। যেমন $$ 12 $$ ও $$ 16 $$ উভয়ই $$ 2 $$ এর গুণিতক। কিন্তু এদের $$ \gcd $$ $$ 2 $$ না। এদের $$ \gcd $$ $$ 4 $$ যা আবার ২ এর গুণিতক। এখন আমরা বুঝতে পারছি, $$ i $$ এর গুণিতক যে নম্বরগুলো আছে তাদের থেকে যেকোনো দুইটি নম্বর নিলে তাদের $$ \gcd $$ এক্সাক্টলি $$ i $$ না হলেও $$ i $$ এর গুণিতক হবে। তাহলে আমরা প্রত্যেক $$ i $$ এর জন্য কতগুলো pair আছে যাদের $$ \gcd $$, $$i $$ এর গুণিতক তা সহজেই বের করতে পারব।

ধরি, $$ g[i] = $$ number of $$ (j, k) $$ such that  $$ 1 \le j \le k \le n $$ && $$ \gcd(j, k) = i $$ এর গুণিতক।

তাহলে $$ n $$ পর্যন্ত $$ i $$ এর গুণিতক যদি $$ m $$ টা হয় তাহলে $$ g[i] = \frac{m(m + 1)} {2} $$

এখন $$ n = 6 $$ সবগুলো $$ g[i] $$ বের করি- \\
$$ g[6] = \frac{1(1 + 1)}{2} = 1 $$  
$$ g[5] = \frac{1(1 + 1)}{2} = 1 $$  
$$ g[4] = \frac{1(1 + 1)}{2} = 1 $$  
$$ g[3] = \frac{2(2 + 1)}{2} = 3 $$  
$$ g[2] = \frac{3(3 + 1)}{2} = 6 $$  
$$ g[1] = \frac{6(6 + 1)}{2} = 21 $$  

এখন আমরা চিন্তা করি $$ g[i] $$ গুলো থেকে $$ f[i] $$ কিভাবে বের করা যায়। কোন একটি $$ i $$ এর জন্য $$ g[i] $$ এর মান $$ f[i] $$ থেকে বেশি হতে পারে। যেমন:\\
$$ f[2] = $$ কতগুলো pair আছে যাদের $$ \gcd 2 $$  
$$ g[2] = $$ কতগুলো pair আছে যাদের $$ \gcd 2 $$ এর গুণিতক = কতগুলো pair আছে যাদের $$ \gcd 2 $$ বা $$ 4 $$ বা $$ 6 $$ \\
তার মানে $$ g[i] $$ থেকে $$ f[i] $$ বের করার জন্য $$ g[i] $$ থেকে $$ i $$ এর বড় $$ i $$ এর যে গুণিতক গুলো আছে তাদের $$ f $$ বাদ (Exclusoin) দিতে হবে। \\
$$ f[6] = g[6] $$  
$$ f[5] = g[5] $$  
$$ f[4] = g[4] $$  
$$ f[3] = g[3] - f[6] $$  
$$ f[2] = g[2] - f[4] - f[6] $$  
$$ f[1] = g[1] - f[2] - f[3] - f[4] - f[5] - f[6] $$  

যেহেতু $$ f[i] $$ বের করার জন্য $$ i $$ এর চেয়ে বড় $$ i $$ এর যে গুণিতক গুলো আছে তাদের $$ f $$ জানা লাগছে এজন্য আমরা বড় নাম্বার গুলার $$ f $$ আগে বের করছি।

তাহলে এখন বলা যায় আমাদের $$ f[i] $$ বের করতে হবে। $$ f[i] $$ বের করার জন্য $$ g[i] $$ জানতে হবে। আর $$ g[i] $$ জানার জন্য আমাদের জানতে হবে প্রত্যেকটি নাম্বার কয়বার করে আছে। (যদিও এই প্রবলেম এর ক্ষেত্রে প্রতিটি নাম্বার একবার করেই আছে)।

### Implementation
```c++
vector<int> freq(n + 1, 1);

vector<ll> g(n + 1);
for (int i = 1; i <= n; ++i) {
    ll m = 0;
    for (int j = i; j <= n; j += i) {
        m += freq[i];
    }
    g[i] = m * (m + 1) / 2;
}

vector<ll> f(n + 1);
for (int i = n; i > 0; --i) {
    f[i] = g[i];
    for (int j = i + i; j <= n; j += i) {
        f[i] -= f[j];
    }
}

```
### Complexity


### Practice Problems

P1. [CSES Counting Coprime Pairs](https://cses.fi/problemset/task/2417)

{: .box-note}
$$ n $$ সাইজের একটি integer array দেওয়া আছে। তোমাকে বের করতে হবে কতগুলো pair আছে যাদের $$ \gcd 1 $$।\\
$$ 1 \le n \le 10^5, 1 \le a_i \le 10^6 $$

আমাদের template problem $$ 1 $$ থেকে $$ n $$ পর্যন্ত $$ n $$ টি নম্বর ছিল। কিন্তু এই প্রবলেমে একটি array দেওয়া আছে। সুতয়াং আমাদের এখন freq array পরিবর্ত্তন হবে আর আন্সার হবে $$ f[1] $$।

P2. [CF Gym 101992D The Millennium Prize Problems](https://codeforces.com/gym/101992/problem/D)

{: .box-note}
$$ n $$ সাইজের একটি integer array দেওয়া আছে। তোমাকে all pair $$ lcm $$ এর sum বের করতে হবে। \\
$$ 1 \le n \le 10^5, 1 \le a_i \le 10^5 $$

P3. [CF 803F Coprime Subsequences](https://codeforces.com/problemset/problem/803/F)

P4. [CF 839D Winter is here](https://codeforces.com/problemset/problem/839/D)